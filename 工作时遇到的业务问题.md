#### 让el-upload像普通按钮一样利用接口来做权限控制

```vue
<el-upload
  class="upload-demo"
  ref="upload"
  action="https://jsonplaceholder.typicode.com/posts/"
  :before-remove="beforeRemove"
  multiple
  :limit="3"
  :on-change="handleChange"
  :file-list="fileList">
  <el-button size="small" type="primary">点击上传</el-button>
</el-upload>
```

这是一个比较普遍的el-upload用法，文件上传后的主要处理函数是`handleChange`，有个业务需求是，点击该按钮，得先通过接口判断权限，有权限的话才能打开选择文件的窗口，没权限就会提示一个报错。

但实际使用时发现el-upload里的按钮并不能像普通按钮一样在`@click`事件里处理接口，我也尝试过在`@before-upload`里调用接口判断权限，但选择文件的窗口依然会打开。

问了谷歌后，发现了一种解决方法：

那就是把el-upload里的按钮放到外面，不与el-upload关联：

```vue
<el-upload
  class="upload-demo"
  ref="upload"
  action="https://jsonplaceholder.typicode.com/posts/"
  :before-remove="beforeRemove"
  multiple
  :limit="3"
  :on-change="handleChange"
  :file-list="fileList">
</el-upload>
<el-button size="small" type="primary" @click="beforeUpload">点击上传</el-button>
```

```js
beforeUpload(){
  await xxx() // 调用接口
  if(···) { // 错误处理 }
  else {
    // 触发upload组件内部点击事件，弹出文件选择框
    this.$refs['upload'].$refs['upload-inner'].handleClick()
  }
}
```

通过`this.$refs['upload'].$refs['upload-inner'].handleClick()`来逐层触发组件内按钮的`handleClick`事件,这样便可实现我们想要的业务需求。