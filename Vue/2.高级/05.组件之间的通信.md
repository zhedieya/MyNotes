[toc]

---

### ä¸€.ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶

#### ç»‘å®šäº‹ä»¶ç›‘å¬

```js
// æ–¹å¼ä¸€: é€šè¿‡v-on ç»‘å®š
@delete_todo="deleteTodo"
// æ–¹å¼äºŒ: é€šè¿‡$on()
this.$refs.xxx.$on('delete_todo', function (todo) {
this.deleteTodo(todo)
})
```

#### è§¦å‘äº‹ä»¶

```js
// è§¦å‘äº‹ä»¶(åªèƒ½åœ¨çˆ¶ç»„ä»¶ä¸­æ¥æ”¶)
this.$emit(eventName, data)
```

#### ğŸŒ°

ä¹‹å‰éƒ½æ˜¯è¿™æ ·ç»‘å®šäº‹ä»¶ç›‘å¬ çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶

```vue
 <TodoHeader :addTodo="addTodo" /> 
```

å˜æˆ

```vue
 <TodoHeader @addTodo="addTodo" />
```

æˆ–è€…è¿™æ ·

```vue
<TodoHeader ref="header" />
```

```js
mounted(){// å¼‚æ­¥æ‰§è¡Œä»£ç 
// ç»‘å®šaddTodoäº‹ä»¶ç›‘å¬
// this.$on('addTodo', this.addTodo) // ç»™Appç»‘å®šç›‘å¬ï¼Œä¸å¯¹çš„
this.$refs.header.$on('addTodo', this.addTodo)
```

å­ç»„ä»¶è§¦å‘äº‹ä»¶

```js
this.addTodo(todo); 
```

å˜æˆ

```js
this.$emit('addTodo', todo)
```

#### æ³¨æ„
æ­¤æ–¹å¼åªç”¨äºå­ç»„ä»¶å‘çˆ¶ç»„ä»¶å‘é€æ¶ˆæ¯(æ•°æ®)
é—®é¢˜: éš”ä»£ç»„ä»¶æˆ–å…„å¼Ÿç»„ä»¶é—´é€šä¿¡æ­¤ç§æ–¹å¼ä¸åˆé€‚

#### æ€»ç»“
1. ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äºï¼š`å­ç»„ä»¶ ===> çˆ¶ç»„ä»¶`

2. ä½¿ç”¨åœºæ™¯ï¼šAæ˜¯çˆ¶ç»„ä»¶ï¼ŒBæ˜¯å­ç»„ä»¶ï¼ŒBæƒ³ç»™Aä¼ æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦åœ¨Aä¸­ç»™Bç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼ˆäº‹ä»¶çš„å›è°ƒåœ¨Aä¸­ï¼‰ã€‚

3. ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼š

â€‹    ç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­ï¼š`<Demo @atguigu="test"/>`æˆ– `<Demo v-on:atguigu="test"/>`

â€‹    ç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­ï¼š

    ```vue
    <Demo ref="demo"/>
    ......
    mounted(){
       this.$refs.xxx.$on('atguigu',this.test)
    }
    ```

â€‹    è‹¥æƒ³è®©è‡ªå®šä¹‰äº‹ä»¶åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨onceä¿®é¥°ç¬¦ï¼Œæˆ–$onceæ–¹æ³•ã€‚

4. è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼š`this.$emit('atguigu',æ•°æ®)`

5. è§£ç»‘è‡ªå®šä¹‰äº‹ä»¶`this.$off('atguigu')`

6. ç»„ä»¶ä¸Šä¹Ÿå¯ä»¥ç»‘å®šåŸç”ŸDOMäº‹ä»¶ï¼Œéœ€è¦ä½¿ç”¨nativeä¿®é¥°ç¬¦ã€‚

7. æ³¨æ„ï¼šé€šè¿‡`this.$refs.xxx.$on('atguigu',å›è°ƒ)`ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œå›è°ƒè¦ä¹ˆé…ç½®åœ¨methodsä¸­ï¼Œè¦ä¹ˆç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thisæŒ‡å‘ä¼šå‡ºé—®é¢˜ï¼



### äºŒ.å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆGlobalEventBusï¼‰

1. ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡ã€‚

2. å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿ï¼š

```js
new Vue({
	......
	beforeCreate() {
		Vue.prototype.$bus = this //å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œ$buså°±æ˜¯å½“å‰åº”ç”¨çš„vm
	},
    ......
}) 
```

3. ä½¿ç”¨å…¨å±€äº‹ä»¶æ€»çº¿

   (1)æ¥æ”¶æ•°æ®ï¼šAç»„ä»¶æƒ³æ¥æ”¶æ•°æ®ï¼Œåˆ™åœ¨Aç»„ä»¶ä¸­ç»™ï¿¥busç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œäº‹ä»¶çš„å›è°ƒç•™åœ¨Aç»„ä»¶è‡ªèº«

   ```js
   methods(){
     demo(data){......}
   }
   ......
   mounted() {
     this.$bus.$on('xxxx',this.demo)
   }
   ```

   (2)æä¾›æ•°æ®ï¼š`this.$bus.$emit('xxx',æ•°æ®)`

4. æœ€å¥½åœ¨beforeDestroy()é’©å­ä¸­ï¼Œç”¨$offå»è§£ç»‘å½“å‰ç»„ä»¶æ‰€ç”¨åˆ°çš„äº‹ä»¶ã€‚

#### ğŸŒ°

> main.js

```js
//å¼•å…¥Vue
import Vue from 'vue'
//å¼•å…¥App
import App from './App.vue'
//å…³é—­Vueçš„ç”Ÿäº§æç¤º
Vue.config.productionTip = false

//åˆ›å»ºvm
new Vue({
	el:'#app',
	render: h => h(App),
	beforeCreate() {
		Vue.prototype.$bus = this //å®‰è£…å…¨å±€äº‹ä»¶æ€»çº¿
	},
})
```

> Student.vue

```vue
<template>
	<div class="student">
		<h2>å­¦ç”Ÿå§“åï¼š{{name}}</h2>
		<h2>å­¦ç”Ÿæ€§åˆ«ï¼š{{sex}}</h2>
		<button @click="sendStudentName">æŠŠå­¦ç”Ÿåç»™Schoolç»„ä»¶</button>
	</div>
</template>

<script>
	export default {
		name:'Student',
		data() {
			return {
				name:'å¼ ä¸‰',
				sex:'ç”·',
			}
		},
		mounted() {
			// console.log('Student',this.x)
		},
		methods: {
			sendStudentName(){
				this.$bus.$emit('hello',this.name)
			}
		},
	}
</script>

```

> School.vue

```vue
<template>
	<div class="school">
		<h2>å­¦æ ¡åç§°ï¼š{{name}}</h2>
		<h2>å­¦æ ¡åœ°å€ï¼š{{address}}</h2>
	</div>
</template>

<script>
	export default {
		name:'School',
		data() {
			return {
				name:'å°šç¡…è°·',
				address:'åŒ—äº¬',
			}
		},
		mounted() {
			// console.log('School',this)
			this.$bus.$on('hello',(data)=>{
				console.log('æˆ‘æ˜¯Schoolç»„ä»¶ï¼Œæ”¶åˆ°äº†æ•°æ®',data)
			})
		},
		beforeDestroy() {
			this.$bus.$off('hello')
		},
	}
</script>
```



### ä¸‰.æ¶ˆæ¯è®¢é˜…ä¸å‘å¸ƒ

1. ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼ï¼Œé€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡ã€‚

2.ä½¿ç”¨æ­¥éª¤ï¼š

   (1) å®‰è£…pubsubï¼š`npm i pubsub-js`

   (2) å¼•å…¥: `import pubsub from 'pubsub-js'`

   (3) æ¥æ”¶æ•°æ®ï¼šAç»„ä»¶æƒ³æ¥æ”¶æ•°æ®ï¼Œåˆ™åœ¨Aç»„ä»¶ä¸­è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…çš„å›è°ƒç•™åœ¨Aç»„ä»¶è‡ªèº«ã€‚

```js
methods(){
  demo(data){......}
}
......
mounted() {
  this.pid = pubsub.subscribe('xxx',this.demo) //è®¢é˜…æ¶ˆæ¯
}
```

3. æä¾›æ•°æ®ï¼š`pubsub.publish('xxx',æ•°æ®)`

4. æœ€å¥½åœ¨beforeDestroyé’©å­ä¸­ï¼Œç”¨`pubsub.unsubscribe(pid)`å»å–æ¶ˆè®¢é˜…ã€‚

#### ğŸŒ°

> App.vue

```vue

<script>
    import pubsub from 'pubsub-js'
    export default {
        name: 'App',
        methods: {
            //3.æ¥æ”¶ä»TodoHeaderä¼ æ¥çš„å‚æ•°å¹¶æ·»åŠ åˆ°todosé‡Œ
            addTodo(todoObj) {
                this.todos.unshift(todoObj);
            },
            //å‹¾é€‰æˆ–è€…å–æ¶ˆå‹¾é€‰ä¸€ä¸ªtodo
            checkTodo(_,id) {
                this.todos.forEach((todo) => {
                    if (todo.id === id) {
                        todo.done = !todo.done;
                    }
                })
            },
            //åˆ é™¤ä¸€ä¸ªtodo
            deleteTodo(_,id) {
                this.todos = this.todos.filter((todo) => {
                    return todo.id !== id
                })
            },
        },
        mounted() {
            //è®¢é˜…æ¶ˆæ¯
            this.pubId1=pubsub.subscribe('checkTodo',this.checkTodo);
            this.pubId2=pubsub.subscribe('deleteTodo',this.deleteTodo);
		 },
	    	beforeDestroy() {
            pubsub.unsubscribe(this.pubId1);
            pubsub.unsubscribe(this.pubId2);
		},    
   }
</script>

```

> TodoItem.vue

```vue
<script>
    import pubsub from 'pubsub-js'
    export default {
        name: 'TodoItem',
        methods: {
            handleCheck(id) {
                //å‘å¸ƒæ¶ˆæ¯
                pubsub.publish('checkTodo',id);
            },
            deleteItem(id) {
                if(confirm('ç¡®å®šåˆ é™¤å—ï¼Ÿ')){
                    pubsub.publish('deleteTodo',id);
                }
            },
        },
        props: ['todo'],
     
    }
</script>
```



### å››.Vuex

[Vuex](08.vuex.md)

 

### äº”.æ’æ§½

[å°çŸ¥è¯†-æ’æ§½](03.vueç›¸å…³å°çŸ¥è¯†.md)